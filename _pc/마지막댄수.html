<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="smooth-content">
      <main id="main">
        <!-- S : 메인 비쥬얼 -->
        <section class="main-visual">
          <h2 class="blind">메인 비쥬얼</h2>
          <iframe
            id="vimeo-player"
            src="https://player.vimeo.com/video/940712688?h=c7fe692a7e&amp;badge=0&amp;autoplay=1&amp;autopause=0&amp;byline=0&amp;controls=0&amp;loop=1&amp;pip=0&amp;playsinlin=0&amp;portrait=0&amp;title=0&amp;background=1&amp;muted=1"
            frameborder="0"
            title="LENINA SUMMER TEASER WEB"
          ></iframe>
        </section>
        <!-- E : 메인 비쥬얼 -->

        <!-- S : 텍스트 배너 -->
        <section class="main-text-banner">
          <figure>
            <img src="https://lenina.kr/web/upload/2024_renewal/pc/emblem_01.svg" alt="장식" />
          </figure>
          <h2 class="text-animation">
            24 SUMMER COLLECTION<br />
            Mon cher, My summer
          </h2>
        </section>
        <!-- E : 텍스트 배너 -->

        <!-- S : 상품 카테고리 -->
        <section class="main-category">
          <h2 class="blind">상품 카테고리 리스트</h2>

          <div class="main-category__inner">
            <div class="main-category__swiper swiper">
              <ul class="swiper-wrapper">
                <li class="swiper-slide main-category__item category__top">
                  <div class="slide-inner" data-swiper-parallax-y="80%">
                    <div class="main-category__desc">
                      <p class="main-category__title">TOP</p>
                      <a href="https://lenina.kr/category/top/45/" class="lenina-button__basic"
                        ><span>Discover Now</span></a
                      >
                    </div>
                  </div>
                </li>
                <li class="swiper-slide main-category__item category__dress">
                  <div class="slide-inner" data-swiper-parallax-y="80%">
                    <div class="main-category__desc">
                      <p class="main-category__title">DRESS</p>
                      <a href="https://lenina.kr/category/dress/66/" class="lenina-button__basic"
                        ><span>Discover Now</span></a
                      >
                    </div>
                  </div>
                </li>
                <li class="swiper-slide main-category__item category__shirt">
                  <div class="slide-inner" data-swiper-parallax-y="80%">
                    <div class="main-category__desc">
                      <p class="main-category__title">SHIRT</p>
                      <a href="https://lenina.kr/category/shirt/43/" class="lenina-button__basic"
                        ><span>Discover Now</span></a
                      >
                    </div>
                  </div>
                </li>
                <li class="swiper-slide main-category__item category__denim">
                  <div class="slide-inner" data-swiper-parallax-y="80%">
                    <div class="main-category__desc">
                      <p class="main-category__title">DENIM</p>
                      <a href="https://lenina.kr/category/denim/44/" class="lenina-button__basic"
                        ><span>Discover Now</span></a
                      >
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </section>
        <!-- E : 상품 카테고리 -->

        <!-- S : 이미지 배너 -->
        <section class="main-gallery">
          <div class="main-gallery__text-wrap">
            <figure>
              <img src="https://lenina.kr/web/upload/drawcode/logo.svg" alt="Lenina" />
            </figure>
            <h2 class="main-gallery__title text-animation">
              <span class="times-font">24</span>&nbsp;SUMMER COLLECTION
            </h2>
            <a href="https://lenina.kr/product/list.html?cate_no=206" class="lenina-button__ribbon"
              ><span>Discover Now</span></a
            >
          </div>

          <div class="main-gallery__img-list">
            <figure class="main-gallery__img" data-img="01">
              <img src="https://lenina.kr/web/upload/2024_renewal/pc/gallery_01.jpg" alt="&nbsp;" />
            </figure>
            <figure class="main-gallery__img" data-img="02">
              <img src="https://lenina.kr/web/upload/2024_renewal/pc/gallery_02.jpg" alt="&nbsp;" />
            </figure>
            <figure class="main-gallery__img" data-img="03">
              <img src="https://lenina.kr/web/upload/2024_renewal/pc/gallery_03.jpg" alt="&nbsp;" />
            </figure>
            <figure class="main-gallery__img" data-img="05">
              <img src="https://lenina.kr/web/upload/2024_renewal/pc/gallery_05.jpg" alt="&nbsp;" />
            </figure>
            <figure class="main-gallery__img" data-img="04">
              <img src="https://lenina.kr/web/upload/2024_renewal/pc/gallery_04.jpg" alt="&nbsp;" />
            </figure>
          </div>
        </section>
        <!-- E : 이미지 배너 -->

        <!-- S : 상품 진열 리스트 -->
        <!-- <div id="horizontal"> -->
        <section class="main-products" module="product_listmain_15">
          <div class="main-products__top">
            <h2 class="main-products__title">New Arrivals</h2>
            <a href="https://lenina.kr/product/list.html?cate_no=206" class="main-products__link">
              <b>Discover Now</b>
              <span>
                <img src="https://lenina.kr/web/upload/2024_renewal/pc/icon_arrow.svg" alt="아이콘" />
              </span>
            </a>
          </div>

          <!--
                  $count = 12
                  $basket_result = /product/add_basket.html
                  $basket_option = /product/basket_option.html
              -->

          <ul class="main-products__item-list">
            <!--@import(/_renewal/cardProduct.html)-->
            <!--@import(/_renewal/cardProduct.html)-->
          </ul>
          <div class="main-products__scrollbar-wrap">
            <div class="main-products__scrollbar">
              <div class="main-products__scrollbar-thumb"></div>
            </div>
          </div>
        </section>
        <!-- E : 상품 진열 리스트 -->

        <!-- S : 하단 텍스트 -->
        <section class="main-bottom-text-banner">
          <h2 class="line-text-animation">
            Experience authentic French mood in Korea. We suggest styles that allow modern women to mix and match in
            their daily lives, transforming the ordinary with exquisite details, colors, and patterns. Discover your
            unique charm beyond the mundane.
          </h2>

          <div class="main-bottom__logo-wrap">
            <figure class="main-bottom__logo">
              <img src="https://lenina.kr/web/upload/drawcode/logo.svg" alt="lenina" />
            </figure>
          </div>
        </section>
        <!-- E : 하단 텍스트 -->
      </main>
    </div>

    <script>
      const headerHeight = "70px";

      // 텍스트 애니메이션
      const textTarget = document.querySelectorAll(".text-animation");
      const lineTextTarget = document.querySelectorAll(".line-text-animation");
      function setupTextSplits() {
        textTarget.forEach((quote) => {
          // Reset if needed
          if (quote.anim) {
            quote.anim.progress(1).kill();
            quote.split.revert();
          }

          quote.split = new SplitText(quote, {
            type: "lines,words,chars",
            linesClass: "split-line",
          });

          // Set up the anim
          quote.anim = gsap.from(quote.split.chars, {
            scrollTrigger: {
              trigger: quote,
              toggleActions: "restart none resume reverse",
              start: "top 80%",
            },
            duration: 0.6,
            ease: "circ.out",
            y: "100%",
            stagger: 0.02,
          });
        });
      }
      function setupLineSplits() {
        // SplitText 플러그인을 사용하여 텍스트 분할
        const split = new SplitText(lineTextTarget, { type: "lines" });

        // GSAP 타임라인 생성
        const tl = gsap.timeline({
          scrollTrigger: {
            trigger: ".main-bottom-text-banner", // 트리거 요소
            start: "top 60%", // 트리거 요소 상단에 닿을 때 실행
            // end: "bottom 20%", // 트리거 요소 하단에 닿을 때 실행
            id: "마지막",
            toggleActions: "play none none reverse", // 진입 시 재생, 벗어날 때 역방향 재생
          },
        });

        // 애니메이션 설정
        tl.from(split.lines, {
          opacity: 0,
          y: "50%",
          duration: 1,
          ease: "power4.out",
          stagger: {
            each: 0.05, // 각 줄 사이의 시간 간격
            from: "start", // 앞에서부터 순차적으로 실행
          },
        });
      }

      // 메인비쥬얼 Pin 고정
      function visualFixed() {
        const visualSection = document.querySelector(".main-visual");

        ScrollTrigger.create({
          trigger: visualSection,
          start: "top top",
          scrub: true,
          pin: true,
          anticipatePin: 1,
          pinSpacing: false,
        });
      }

      // 갤러리 애니메이션
      function galleryAnimation() {
        const ani2 = gsap.timeline();
        ani2
          .from(".main-gallery__img[data-img='01']", {
            x: -100,
            autoAlpha: 0,
            duration: 4,
          })
          .from(".main-gallery__img[data-img='02']", {
            x: 100,
            autoAlpha: 0,
            duration: 4,
          })
          .from(".main-gallery__img[data-img='03']", {
            x: -100,
            autoAlpha: 0,
            duration: 4,
          })
          .from(".main-gallery__img[data-img='04']", {
            x: 200,
            autoAlpha: 0,
            duration: 4,
          })
          .from(".main-gallery__img[data-img='05']", {
            y: 100,
            autoAlpha: 0,
            duration: 4,
          });

        ScrollTrigger.create({
          animation: ani2,
          trigger: ".main-gallery",
          // start: "top top",
          start: "top-=" + headerHeight + " top", // 헤더높이 뺀값을 시작 점으로 잡기
          end: "+=2000",
          pinnedContainer: ".main-gallery__img-list",
          scrub: true,
          pin: true,
          ease: "circ.out",
          anticipatePin: 1,
          markers: false,
        });
      }

      // 프로덕트 섹션 [GSAP 가로스크롤 + 스크롤바]
      function productAnimation() {
        const container = document.querySelector(".main-products");
        const wrapper = container.querySelector(".main-products__item-list");
        const scrollbar = document.querySelector(".main-products__scrollbar");
        const scrollbarThumb = document.querySelector(".main-products__scrollbar-thumb");

        // 스크롤을 관리할 Tween을 생성합니다.
        const scrollTween = gsap.to(wrapper, {
          x: () => -(wrapper.clientWidth - container.clientWidth),
          ease: "none",
          scrollTrigger: {
            trigger: container,
            start: "top top",
            end: () => `+=${wrapper.clientWidth}`,
            scrub: 1,
            pin: true,
            anticipatePin: 1,
            invalidateOnRefresh: true,
            duration: 2,
            onUpdate: (self) => {
              const progress = self.progress;
              const scrollWidth = wrapper.scrollWidth - wrapper.clientWidth;
              const thumbWidth = scrollbarThumb.offsetWidth;
              const maxThumbPosition = scrollbar.clientWidth - thumbWidth;
              const thumbPosition = progress * maxThumbPosition;
              gsap.set(scrollbarThumb, { x: thumbPosition });

              // 스크롤바의 길이를 조정합니다.
              let scrollbarWidth = container.clientWidth * (container.clientWidth / wrapper.clientWidth);
              scrollbarWidth = Math.min(container.clientWidth, scrollbarWidth); // 최대 컨테이너 너비로 제한합니다.
              gsap.set(scrollbar, { width: scrollbarWidth });
            },
          },
        });

        // 스크롤 바를 드래그할 때 내용물을 스크롤하도록 설정합니다.
        Draggable.create(scrollbarThumb, {
          type: "x",
          bounds: ".main-products__scrollbar",
          inertia: true,
          onDrag: function () {
            const progress = this.x / (this.maxX - this.minX);
            const scrollX = gsap.utils.mapRange(
              0,
              1,
              0,
              wrapper.clientWidth,
              progress * (wrapper.clientWidth - container.clientWidth)
            );
            TweenMax.to(scrollTween, {
              progress: progress,
              scrollTo: { x: scrollX },
            });
          },
        });
      }

      function categorySlide() {
        let currentSlideIndex = 0;
        const swiperInner = document.querySelector(".main-category__inner");
        const cateSwiper = new Swiper(".main-category__swiper", {
          direction: "vertical",
          resistance: false,
          touchReleaseOnEdges: true,
          parallax: true,
          touchStartPreventDefault: false,
          preventInteractionOnTransition: false,
          speed: 500,
          sensitivity: 1,
          resistance: false,
          mousewheel: {
            enabled: true,
          },
          on: {
            slideChange: function () {
              currentSlideIndex = this.activeIndex;
            },
            slideChangeTransitionEnd: function () {
              if (this.isEnd || this.isBeginning) {
                swiperInner.classList.remove("fixed");
                document.body.style.overflow = "auto";
                DisableMouseWheel();

                if (this.isEnd) {
                  window.scrollTo(0, cateSwiperSection.offsetTop + 1);
                } else if (this.isBeginning) {
                  window.scrollTo(0, cateSwiperSection.offsetTop - 1);
                }
              }
            },
          },
        });

        // 현재 스크롤 위치 추적
        let CONTAINER_SCROLL_TOP = 0;
        let currentScroll;
        let deltaY; //-올라가는거 + 내려가는거

        const cateSwiperSection = document.querySelector(".main-category");
        window.addEventListener("scroll", (e) => {
          currentScroll = document.documentElement.scrollTop; // 현재 스크롤바 위치
          deltaY = currentScroll - CONTAINER_SCROLL_TOP;

          if (cateSwiperSection.getBoundingClientRect().top <= 0) {
            if (currentSlideIndex === 0 && deltaY > 0) {
              swiperInner.classList.add("fixed");
              document.body.style.overflow = "hidden";
              ActiveMouseWheel();
            }
          }
          if (cateSwiper.activeIndex !== 0 && deltaY < 0 && cateSwiperSection.getBoundingClientRect().top >= 0) {
            swiperInner.classList.add("fixed");
            document.body.style.overflow = "hidden";
            ActiveMouseWheel();
          }

          CONTAINER_SCROLL_TOP = currentScroll;
        });

        const scrollHandler = () => {
          CONTAINER_SCROLL_TOP = $CONTAINER.scrollTop;
          console.log(CONTAINER_SCROLL_TOP);
          scrollFixedTab(); // 탭 고정 여부 업데이트
        };

        function ActiveMouseWheel() {
          cateSwiper.mousewheel.enable();
          cateSwiper.mousewheel.sensitivity = 0.5;
          // cateSwiper.mousewheel.releaseOnEdges = true;
        }

        function DisableMouseWheel() {
          cateSwiper.mousewheel.disable();
          cateSwiper.mousewheel.sensitivity = 0;
          cateSwiper.mousewheel.releaseOnEdges = false;
        }
      }

      visualFixed();
      ScrollTrigger.addEventListener("refresh", setupTextSplits);
      ScrollTrigger.addEventListener("refresh", setupLineSplits);
      categorySlide();
      galleryAnimation(); // 갤러리 애니메이션
      productAnimation(); // 프로덕트 섹션 [GSAP 가로스크롤 + 스크롤바]
    </script>
  </body>
</html>
